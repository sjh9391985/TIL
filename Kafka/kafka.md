### Kafka 란?

- source application 과 target application의 커플링을 약하게 하기 위해 등장
- source application 이 appache kafka에 데이터를 전송하고 target application은 kafka에서 데이터를 가져오면 됨.

#### source application

- ex) 쇼핑몰의 클릭로그, 결제로그 등을 보낼수 있음.
- 보내는 데이터 형식의 제한이 거의 없음(Json, tsv, avro etc...)

#### target application

- 로그적재, 로그처리 등의 역할을 함.

### Kafka 구조

- 각종 데이터를 담은 토픽이라는 개념이 존재 (큐와 유사함.)
- 데이터를 넣는 역할은 프로듀서가 함.
- 데이터를 가져오는 것은 컨슈머가 함.

### Kafka 토픽

- 카프카에선 토픽을 여러개 생성할 수 있음.
- 토픽은 데이터베이스 테이블이나 파일시스템의 폴더와 유사한 성질을 가짐.
- 토픽은 "click_log", "send_sms", "location_log" 등의 이름을 지을수 있고, 추후 유지보수 시 편리하게 관리 할 수 있음.

#### Kafka 토픽 내부구조

- 하나의 토픽은 여러개의 파티션으로 구성될 수 있음.
- 첫번째 파티션은 #0번부터 시작을 함.
- 하나의 파티션은 큐와같이 내부의 데이터가 파티션끝에서부터 순차적으로 쌓이게 됨.
- 클릭로그 토픽에 카프카 컨슈머가 붙게되면 데이터를 가장 오래된 순서대로 가져가게 됨.
- 더이상 데이터가 들어오지 않으면 또 다른 데이터가 들어올때가지 기다림.
- 컨슈머가 파티션에서도 데이터를 가져가더라도 데이터는 삭제되지 않음.
- 남아있는 파티션 데이터는 새로운 컨슈머가 등장하면 0번부터 가져갈 수 있음.[단, 컨슈머그룹이 달라야하고 auto.offset.reset = earliest로 세팅이 되어야 함.]

#### 파티션이 2개 이상인 경우

- 데이터를 전송 시 key 를 지정하여 보낼 수 있음
- key가 null, 즉 키를 지정하지 않고 기본 파티셔너 설정 시 round-robin으로 파티션이 할당됨. 
- key가 있고 기본 파티셔너 사용시 특정 파티션에 할당되게 됨.
- 파티션을 늘리는것은 가능하지만 줄이는것은 불가능하기 때문에 파티션을 다시 줄일 수 없음.
- 파티션을 늘리면 컨슈머의 개수를 늘려서 데이터 처리를 분산시킬 수 있음.

#### 파티션 삭제

- 레코드가 저장되는 최대 시간과 크기를 옵션에 따라 지정할 수 있음
- 일정 기간, 용량 데이터를 저장 할 수 있게됨.
- 적절하게 데이터가 삭제되도록 할 수 잇음.
